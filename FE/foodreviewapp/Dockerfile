FROM node:18-alpine AS builder

WORKDIR /app

# ğŸ“¦ ë¹Œë“œ ì•„ê·œë¨¼íŠ¸ ì •ì˜ (GitHub Actionsì—ì„œ ì „ë‹¬ë¨)
ARG NEXT_PUBLIC_LOCAL_BACK_URL
ARG NEXT_PUBLIC_KAKAO_JAVA_SCRIPT_KEY

# ğŸ”§ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì • (ë¹Œë“œ ì‹œì ì— ë²ˆë“¤ì— í¬í•¨ë¨)
ENV NEXT_PUBLIC_LOCAL_BACK_URL=$NEXT_PUBLIC_LOCAL_BACK_URL
ENV NEXT_PUBLIC_KAKAO_JAVA_SCRIPT_KEY=$NEXT_PUBLIC_KAKAO_JAVA_SCRIPT_KEY

# ğŸ› ë””ë²„ê¹…ìš© ë¡œê·¸ (ë¹Œë“œ ì‹œì ì—ì„œ í™˜ê²½ë³€ìˆ˜ í™•ì¸)
RUN echo "ğŸ” ë¹Œë“œ ì‹œì  í™˜ê²½ë³€ìˆ˜ í™•ì¸:"
RUN echo "NEXT_PUBLIC_LOCAL_BACK_URL: $NEXT_PUBLIC_LOCAL_BACK_URL"
RUN echo "NEXT_PUBLIC_KAKAO_JAVA_SCRIPT_KEY: ${NEXT_PUBLIC_KAKAO_JAVA_SCRIPT_KEY:0:10}..."

COPY package*.json ./
COPY pnpm-lock.yaml ./
RUN npm install -g pnpm
RUN pnpm install

COPY . .
RUN pnpm build

FROM node:18-alpine AS runner
WORKDIR /app

ENV NODE_ENV production

COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static

EXPOSE 3000
CMD ["node", "server.js"] 